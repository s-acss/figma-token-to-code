<style>
  body {
    margin: 0;
    padding: 0;
  }

  .wrap {
    margin: 0 16px;
  }

  .btn,
  textarea,
  body {
    font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif;
  }

  .btn {
    background-color: #18a0fb;
    color: #ffffff;
    border: none 0;
    font-size: 16px;
    padding: 0.75em 1em;
    cursor: pointer;
    border-radius: 0.25em;
    text-transform: capitalize;
  }

  .btn._block {
    display: block;
    width: 100%;
  }

  .btn:hover {
    background-color: #1a8bd6;
  }

  .btn-group {
    display: flex;
  }

  .textarea {
    display: block;
    border: none 0;
    width: 100%;
    resize: none;
    padding: 8px 16px;
  }

  .textarea+.textarea {
    border-top: 1px solid #e5e5e5;
  }

  .msg {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #4c5fe2;
    color: #ffffff;
    padding: 8px 16px;
    text-transform: capitalize;
    transition: 200ms;
    visibility: hidden;
    opacity: 0;
    transform: translateY(100%);
  }

  .msg._on {
    visibility: visible;
    opacity: 1;
    transform: translateY(0);
  }
</style>

<form id="formHtml">
  <textarea class="textarea" id="cssBody" placeholder="CSS here" cols="30" rows="10"></textarea>
  <textarea class="textarea" id="htmlBody" placeholder="select text and generator" cols="30" rows="10"></textarea>
  <div class="wrap">
    <button type="submit" class="btn _block">Generator</button>
  </div>
</form>

<form id="formSetting">
  <textarea class="textarea" id="settingBody" cols="30" rows="10" placeholder="enter your setting here"></textarea>
  <div class="wrap">
    <button type="button" id="btnGetAllStyle" class="btn _block">Get Local Styles Name</button>
    <button type="button" id="btnGetSetting" class="btn _block">Get setting</button>
    <button type="submit" class="btn _block">Save</button>
  </div>
</form>

<script>
  const objSettingBody = document.getElementById('settingBody');

  //
  const objFormHtml = document.getElementById('formHtml');
  const objHtmlBody = document.getElementById('htmlBody');
  const objCSSBody = document.getElementById('cssBody');

  //
  const objFormSetting = document.getElementById('formSetting');
  const objBtnGetSetting = document.getElementById('btnGetSetting');
  //
  const btnGetAllStyle = document.getElementById('btnGetAllStyle');

  // msg
  const objMsgBox = document.getElementById('msgBox');
  const objBody = document.body;

  const _api = {
    showStyleInfo: function (data) {
      let text = '';
      data.map(({ name, value }) => {
        text += `${name}:${value}\n`;
      });
      objSettingBody.value = text;
    },
    showSetting: function (data) {
      let text = '';
      data.map(({ name, value }) => {
        text += `${name}:${value}\n`;
      });
      objSettingBody.value = text;
    },
    showHtml: function ({ html, css }) {
      objHtmlBody.value = html;
      objCSSBody.value = css;
      objHtmlBody.select();
    },
    showMsg: function (msg) {
      const objMsg = document.createElement('div');
      objMsg.classList.add('msg');
      objMsg.innerText = msg;
      objBody.append(objMsg);
      setTimeout(function () {
        objMsg.classList.add('_on');
        setTimeout(function () {
          objMsg.classList.remove('_on');
          setTimeout(function () {
            objMsg.remove();
          }, 201);
        }, 3000);
      }, 16);
    }
  };

  // 获取html
  objFormHtml.addEventListener('submit', function (e) {
    e.preventDefault();
    htmlBody.value = "";
    cssBody.value = "";
    parent.postMessage({
      pluginMessage: {
        type: 'getHtml'
      }
    }, '*');
  });

  // 获取设置
  objBtnGetSetting.addEventListener('click', function () {
    parent.postMessage({
      pluginMessage: {
        type: 'getSetting'
      }
    }, '*');
  });

  // 保存设置
  objFormSetting.addEventListener('submit', function (e) {
    e.preventDefault();
    parent.postMessage({
      pluginMessage: {
        type: 'saveSetting',
        data: objSettingBody.value
      }
    }, '*');
  });

  // 获取所有的样式名称
  btnGetAllStyle.addEventListener('click', function (e) {
    e.preventDefault();
    parent.postMessage({
      pluginMessage: {
        type: 'getStyleInfo'
      }
    }, '*');
  });

  onmessage = ((event) => {
    const { type, data, msg } = event.data.pluginMessage;
    if (type === 'showMsg') {
      _api.showMsg(msg);
    } else {
      _api[type] && _api[type](data);
      !!msg && _api.showMsg(msg);
    }
  });
</script>