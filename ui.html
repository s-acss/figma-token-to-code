<style>
  /* css reset */
  body {
    margin: 0;
    padding: 40px 0 0;
  }

  form {
    margin: 0;
  }

  pre,
  strong,
  small {
    font: inherit;
  }

  pre {
    margin: 0;
    padding: 0;
  }

  svg {
    fill: currentColor;
  }

  a {
    text-decoration: none;
    color: inherit;
  }

  hr {
    margin: 0;
    padding: 0;
  }

  /* ACSS */
  .df {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
  }

  .jcsb {
    -webkit-box-pack: justify;
    -ms-flex-pack: justify;
    justify-content: space-between;
  }

  .aic {
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
  }

  .pa {
    position: absolute;
  }

  .pf {
    position: fixed;
  }

  .t0 {
    top: 0;
  }

  .b0 {
    bottom: 0;
  }

  .l0 {
    left: 0;
  }

  .r0 {
    right: 0;
  }

  .vh {
    visibility: hidden;
  }

  .mb16 {
    margin-bottom: 16px;
  }

  .mb8 {
    margin-bottom: 8px;
  }

  .mr8 {
    margin-right: 8px;
  }

  .mt8 {
    margin-top: 8px;
  }

  /* module */
  .wrap {
    margin-left: 16px;
    margin-right: 16px;
  }

  .row {
    padding-left: 16px;
    padding-right: 16px;
  }

  .hr {
    border: none 0;
    border-bottom: 1px solid #E0E5E5;
  }

  /* tab */
  .tab-switch {
    position: absolute;
  }

  .tab-nav {
    border-bottom: 1px solid #E0E5E5;
    background-color: #fff;
  }

  .tab-nav-item {
    white-space: nowrap;
    font-size: 12px;
    line-height: 16px;
    padding: 1em 0;
    color: #999999;
    font-weight: 600;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    display: inline-block;
  }

  .tab-nav-item+.tab-nav-item {
    margin-left: 1em;
  }

  .tab-panel {
    display: none;
  }

  .tab-nav-item:hover,
  #tabSwitch1:checked~.tab-nav .tab-nav-item[for="tabSwitch1"],
  #tabSwitch2:checked~.tab-nav .tab-nav-item[for="tabSwitch2"],
  #tabSwitch3:checked~.tab-nav .tab-nav-item[for="tabSwitch3"] {
    color: #333;
  }

  #tabSwitch1:checked~#formHtml {
    display: block;
  }

  #tabSwitch2:checked~#formSetting {
    display: block;
  }

  #tabSwitch3:checked~#formTocken {
    display: block;
  }

  /* button */
  .btn,
  textarea,
  body {
    font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif;
  }

  .btn {
    border: none 0;
    font-size: 12px;
    padding: 0.75em 1em;
    cursor: pointer;
    text-transform: capitalize;
    border-radius: 8px;
    color: #333;
    border: 1px solid;
    background-color: transparent;
    -webkit-transition: 200ms;
    transition: 200ms;
    outline: none;
  }

  .btn:disabled {
    opacity: 0.3;
    pointer-events: none;
    cursor: not-allowed;
  }

  .btn._block {
    display: block;
    width: 100%;
  }

  .btn:hover {
    background-color: rgba(0, 0, 0, 0.02);
  }

  .btn:active {
    -webkit-transform: scale(0.98);
    transform: scale(0.98);
  }

  .btn-group {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
  }

  /* textarea */
  .textarea {
    display: block;
    border: none 0;
    border-bottom: 1px solid #E0E5E5;
    width: 100%;
    resize: none;
    padding: 1em 16px;
    background-color: #ffffff;
    font-size: 12px;
    line-height: 1.5;
    border-radius: 0;
    -webkit-transition: 200ms;
    transition: 200ms;
  }

  .textarea._reverse {
    border-bottom: none 0;
    border-top: 1px solid #E0E5E5;
  }

  .textarea:focus {
    outline: none;
    border-color: #333333;
  }

  /* setting-demo */
  .setting-demo {
    font-size: 12px;
    line-height: 1.5em;
    color: #999;
    padding-top: 8px;
    margin-bottom: -1em;
  }

  .setting-demo strong {
    color: #905;
  }

  .setting-demo small {
    color: #690;
  }

  /* link-github */
  .link-github {
    display: -webkit-inline-box;
    display: -ms-inline-flexbox;
    display: inline-flex;
    width: 40px;
    height: 40px;
    line-height: 40px;
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    margin-right: -16px;
  }

  .link-github:active {
    background-color: rgba(0, 0, 0, 0.08);
  }

  /* msg*/
  .msg {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    font-size: 12px;
    background-color: #4c5fe2;
    color: #ffffff;
    padding: 1em 16px;
    line-height: 16px;
    text-transform: capitalize;
    -webkit-transition: 200ms;
    transition: 200ms;
    visibility: hidden;
    opacity: 0;
    -webkit-transform: translateY(100%);
    transform: translateY(100%);
  }

  .msg._on {
    visibility: visible;
    opacity: 1;
    -webkit-transform: translateY(0);
    transform: translateY(0);
  }
</style>

<input class="pa vh" id="tabSwitch1" type="radio" name="tab" checked>
<input class="pa vh" id="tabSwitch2" type="radio" name="tab">
<input class="pa vh" id="tabSwitch3" type="radio" name="tab">

<div class="tab-nav df aic jcsb row pf t0 l0 r0">
  <div>
    <label class="tab-nav-item" for="tabSwitch1">Generator</label>
    <label class="tab-nav-item" for="tabSwitch2">Setting</label>
    <label class="tab-nav-item" for="tabSwitch3">Token</label>
  </div>
  <a class="link-github" href="https://github.com/ziven27/Figma-ACSS" target="_blank" title="github for help">
    <svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
      <path
        d="M512 42.667a464.64 464.64 0 0 0-469.333 459.52 460.373 460.373 0 0 0 320.853 436.48c23.467 4.266 32-9.814 32-22.187V838.4c-130.56 27.733-158.293-61.44-158.293-61.44a122.027 122.027 0 0 0-52.054-67.413c-42.666-28.16 3.414-27.734 3.414-27.734a98.56 98.56 0 0 1 71.68 47.36A101.12 101.12 0 0 0 396.8 767.147a99.413 99.413 0 0 1 29.867-61.44c-104.107-11.52-213.334-50.774-213.334-226.987a177.067 177.067 0 0 1 47.36-124.16 161.28 161.28 0 0 1 4.694-121.173s39.68-12.374 128 46.933a455.68 455.68 0 0 1 234.666 0c89.6-59.307 128-46.933 128-46.933a161.28 161.28 0 0 1 4.694 121.173 177.067 177.067 0 0 1 49.92 123.307c0 176.64-110.08 215.466-213.334 226.986a106.667 106.667 0 0 1 32 85.334v125.866c0 14.934 8.534 26.88 32 22.187a460.8 460.8 0 0 0 320-436.053A464.64 464.64 0 0 0 512 42.667" />
    </svg>
  </a>
</div>

<form class="tab-panel" id="formHtml">
  <textarea readonly class="textarea" id="cssBody" cols="30" placeholder="CSS will show here" rows="8"></textarea>
  <textarea readonly class="textarea mb16" id="htmlBody" placeholder="Select text & Click generate" cols="30"
    rows="16"></textarea>
  <div class="wrap mb16">
    <button type="submit" class="btn _block">Generate</button>
  </div>
</form>

<form class="tab-panel" id="formSetting">
  <pre class="setting-demo wrap"><strong>localStyleName</strong>:<small>className</small></pre>
  <textarea class="textarea mb16" id="settingBody" cols="30" rows="24" placeholder="Plsease enter your settings one by one split with new line like blow:
localStyleName:className
localStyleName:className
localStyleName:className
...
  "></textarea>
  <div class="wrap df mb8">
    <button type="button" id="btnFormatSettting" class="btn _block mr8">Format</button>
    <button type="submit" id="btnSaveSetting" class="btn _block" disabled>Save</button>
  </div>
</form>

<form class="tab-panel" id="formTocken">
  <textarea class="textarea mb16" id="styleNameBody" readonly cols="30" rows="25" placeholder="Walking through all the elements in current page 
may take some time"></textarea>
  <div class="wrap mb16">
    <button type="button" id="btnGetAllStyle" class="btn _block">Get All Text Local Style Name</button>
  </div>
</form>

<script>
  const objSettingBody = document.getElementById('settingBody');

  //
  const formHtml = document.getElementById('formHtml');
  const objHtmlBody = document.getElementById('htmlBody');
  const objCSSBody = document.getElementById('cssBody');

  //
  const btnFormatSettting = document.getElementById('btnFormatSettting');
  const btnSaveSetting = document.getElementById('btnSaveSetting');
  //
  const btnGetAllStyle = document.getElementById('btnGetAllStyle');
  const objStyleNameBody = document.getElementById('styleNameBody');

  // msg
  const objMsgBox = document.getElementById('msgBox');
  const objBody = document.body;


  const _api = {
    showStyleInfo: function (data) {
      objStyleNameBody.value = data || '';
    },
    showSetting: function (data) {
      let text = '';
      data.map(({ name, value }) => {
        text += `${name}: ${value}\n`;
      });
      objSettingBody.value = text;
      btnSaveSetting.disabled = true;
    },
    showHtml: function ({ html, css }) {
      objHtmlBody.value = html;
      objCSSBody.value = css;
      objHtmlBody.select();
    },
    showMsg: function (msg) {
      const objMsg = document.createElement('div');
      objMsg.classList.add('msg');
      objMsg.innerText = msg;
      objBody.append(objMsg);
      setTimeout(function () {
        objMsg.classList.add('_on');
        setTimeout(function () {
          objMsg.classList.remove('_on');
          setTimeout(function () {
            objMsg.remove();
          }, 201);
        }, 3000);
      }, 16);
    },
    getSetting: function () {
      parent.postMessage({
        pluginMessage: {
          type: 'getSetting'
        }
      }, '*');
    },
    formatSetting: function () {
      const data = objSettingBody.value;
      const dataArray = data.split('\n');
      const objData = {};
      dataArray.map(item => {
        const [name, value] = item.split(':');
        if (!!name && !!value) {
          objData[name.trim()] = value.trim();
        }
      });
      let dataString = '';
      Object.keys(objData).map((name) => {
        const value = objData[name];
        dataString += name + ': ' + value + '\n';
        return name;
      });
      objSettingBody.value = dataString;
      btnSaveSetting.disabled = false;
    }
  };

  // 全选文本
  document.querySelectorAll('textarea').forEach((item) => {
    return item.addEventListener('keydown', function (e) {
      const mac = !e.shiftKey && !e.ctrlKey && e.metaKey;
      const notMac = !e.shiftKey && !e.metaKey && e.ctrlKey;
      if (e.keyCode === 65 && (mac || notMac)) {
        e.preventDefault();
        this.select();
      }
    });
  });

  // 获取html
  formHtml.addEventListener('submit', function (e) {
    e.preventDefault();
    htmlBody.value = "Generating...";
    cssBody.value = "";
    parent.postMessage({
      pluginMessage: {
        type: 'getHtml'
      }
    }, '*');
  });


  document.getElementById('tabSwitch2').addEventListener('change', function () {
    _api.getSetting();
  });

  btnFormatSettting.addEventListener('click', function (e) {
    e.preventDefault();
    _api.formatSetting();
  });

  // 保存设置
  btnSaveSetting.addEventListener('click', function (e) {
    e.preventDefault();
    parent.postMessage({
      pluginMessage: {
        type: 'saveSetting',
        data: objSettingBody.value.trim()
      }
    }, '*');
  });

  // 获取所有的样式名称
  btnGetAllStyle.addEventListener('click', function (e) {
    e.preventDefault();
    objStyleNameBody.value = "Loading..."
    parent.postMessage({
      pluginMessage: {
        type: 'getStyleInfo'
      }
    }, '*');
  });

  onmessage = ((event) => {
    const { type, data, msg } = event.data.pluginMessage;
    if (type === 'showMsg') {
      _api.showMsg(msg);
    } else {
      _api[type] && _api[type](data);
      !!msg && _api.showMsg(msg);
    }
  });
</script>