<style>
  body {
    font-family: sans-serif;
  }

  textarea {
    width: 100%;
    resize: vertical;
    margin-bottom: 0.5em;
  }

  .msg {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #4c5fe2;
    color: #ffffff;
    padding: 8px 16px;
    text-transform: capitalize;
    transition: 200ms;
    visibility: hidden;
    opacity: 0;
    transform: translateY(100%);
  }

  .msg._on {
    visibility: visible;
    opacity: 1;
    transform: translateY(0);
  }
</style>

<form id="formHtml">
  <textarea id="htmlBody" placeholder="select text and generator" cols="30" rows="10"></textarea>
  <textarea id="cssBody" placeholder="css" cols="30" rows="10"></textarea>
  <button type="submit">Generator</button>
</form>

<form id="formSetting">
  <textarea id="settingBody" cols="30" rows="10"></textarea>
  <button type="button" id="btnGetSetting">Get setting</button>
  <button type="submit">Save</button>
</form>

<form id="formStyles">
  <textarea id="styleBody" cols="30" rows="10"></textarea>
  <button type="submit">Get Style</button>
</form>

<div id="msgBox"></div>
<script>
  const objSettingBody = document.getElementById('settingBody');

  //
  const objFormHtml = document.getElementById('formHtml');
  const objHtmlBody = document.getElementById('htmlBody');
  const objCSSBody = document.getElementById('cssBody');

  //
  const objFormSetting = document.getElementById('formSetting');
  const objBtnGetSetting = document.getElementById('btnGetSetting');

  //
  const objFormStyles = document.getElementById('formStyles');
  const objStyleBody = document.getElementById('styleBody');

  // msg
  const objMsgBox = document.getElementById('msgBox');
  const objBody = document.body;

  const _api = {
    showStyleInfo: function (data) {
      let text = '';
      data.map(({ name, value }) => {
        text += `${name}:${value}\n`;
      });
      objStyleBody.value = text;
    },
    showSetting: function (data) {
      let text = '';
      data.map(({ name, value }) => {
        text += `${name}:${value}\n`;
      });
      objSettingBody.value = text;
    },
    showHtml: function ({ html, css }) {
      objHtmlBody.value = html;
      objCSSBody.value = css;
      objHtmlBody.select();
    },
    showMsg: function (msg) {
      const objMsg = document.createElement('div');
      objMsg.classList.add('msg');
      objMsg.innerText = msg;
      objBody.append(objMsg);
      setTimeout(function () {
        objMsg.classList.add('_on');
        setTimeout(function () {
          objMsg.classList.remove('_on');
          setTimeout(function () {
            objMsg.remove();
          }, 201);
        }, 3000);
      }, 16);
    }
  };

  // 获取设置
  objBtnGetSetting.addEventListener('click', function () {
    parent.postMessage({
      pluginMessage: {
        type: 'getSetting'
      }
    }, '*');
  });

  // 获取html
  objFormHtml.addEventListener('submit', function (e) {
    e.preventDefault();
    parent.postMessage({
      pluginMessage: {
        type: 'getHtml'
      }
    }, '*');
  });

  // 保存设置
  objFormSetting.addEventListener('submit', function (e) {
    e.preventDefault();
    parent.postMessage({
      pluginMessage: {
        type: 'saveSetting',
        data: objSettingBody.value
      }
    }, '*');
  });

  // 设置
  objFormStyles.addEventListener('submit', function (e) {
    e.preventDefault();
    parent.postMessage({
      pluginMessage: {
        type: 'getStyleInfo'
      }
    }, '*');
  });

  // html
  objFormHtml.addEventListener('submit', function (e) {
    e.preventDefault();
  });

  onmessage = ((event) => {
    const { type, data, msg } = event.data.pluginMessage;
    if (type === 'showMsg') {
      _api.showMsg(msg);
    } else {
      _api[type] && _api[type](data);
      !!msg && _api.showMsg(msg);
    }
  });
</script>